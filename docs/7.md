# Commit 阶段的 3 个子阶段与副作用执行全解析

# 一、前言

Commit 阶段是 React 更新流程的最后一环，用于把 Render 阶段计算出的变更与副作用原子化地应用到宿主环境（DOM），确保界面一致性与不出现中间态。

# 二、React 全流程视角下的 Commit 阶段

## 2.1 React 渲染全流程回顾（触发 → 调度 →Render→Commit→ 绘制 → 被动阶段）

## 2.2 Commit 阶段的核心目标（原子化应用 DOM 变更、执行副作用、保证界面一致性）

## 2.3 Commit 阶段的不可中断特性（为什么 DOM 操作必须同步执行？）

# 三、Commit 阶段源码关键函数解析

## 3.1 入口函数：commitRoot（Commit 阶段总调度器）

## 3.2 核心工具函数：effectList 遍历机制（为什么不用遍历整个 Fiber 树？）

## 3.3 关键标记：flags 与 subtreeFlags 副作用标记体系（如 Placement/Update/Deletion）

## 3.4 被动阶段：flushPassiveEffects（useEffect 回调的异步调度逻辑）

# 四、Commit 阶段三大子阶段拆解

## 4.1 子阶段一：DOM 操作（Placement/Update/Deletion）

## 4.2 子阶段二：执行副作用（useEffect 回调）

## 4.3 子阶段三：绘制（layoutEffect 回调）
